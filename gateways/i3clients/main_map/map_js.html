<html>
<head>
<meta charset="utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



<style>
#map {
height: 500px;
width: 100%
}
body {
 font-family: "Times New Roman", Georgia, Serif;
 background-color:   #eef347;
}


</style>

</head>
<script type="text/javascript">
	var num = 0;

        var markersH;
        var markersG;
        var markersD;
        var markersI;
        var markersE;
        var markersB;
        var markersM;
        var markersW;
        var markersSS;
        var markersMS;
	
        var pinIconH = 'http://www.googlemapsmarkers.com/v1/H/ADFF2F/';
        var pinIconG = 'http://www.googlemapsmarkers.com/v1/G/009900/';
        var pinIconD = 'http://www.googlemapsmarkers.com/v1/D/ffff00/';
        var pinIconI = 'http://www.googlemapsmarkers.com/v1/I/0000ff/';
        var pinIconE = 'http://www.googlemapsmarkers.com/v1/E/ffa500/';
        var pinIconB = 'http://www.googlemapsmarkers.com/v1/B/ff69b4/';
        var pinIconM = 'http://www.googlemapsmarkers.com/v1/M/ee00ee/';
        var pinIconW = 'http://www.googlemapsmarkers.com/v1/W/87ceeb/';
        var pinIconSS = 'http://www.googlemapsmarkers.com/v1/SS/c0c0c0/';
        var pinIconMS = 'http://www.googlemapsmarkers.com/v1/MS/d2b48c/';
        var pinIconC = 'http://www.googlemapsmarkers.com/v1/C/ff0000/';



	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Dead Animal Removal"', function(data) {
    //data is the JSON string
	markersD = data;
	setCoord(markersD,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Illegal Dumping Pickup"', function(data) {
    //data is the JSON string
	markersI = data;
	setCoord(markersI,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Electronic Waste"', function(data) {
    //data is the JSON string
	markersE = data;
	setCoord(markersE,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Bulky Items"', function(data) {
    //data is the JSON string
	markersB = data;
	setCoord(markersB,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Metal/Household Appliances"', function(data) {
    //data is the JSON string
	markersM = data;
	setCoord(markersM,false);
        })

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Report Water Waste"', function(data) {
    //data is the JSON string
	markersW = data;
	setCoord(markersW,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Single Streetlight Issue"', function(data) {
    //data is the JSON string
	markersSS = data;
	setCoord(markersSS,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Multiple Streetlight Issue"', function(data) {
    //data is the JSON string
	markersMS = data;
	setCoord(markersMS,false);
        });   

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Homeless Encampment"', function(data) {
    //data is the JSON string
	markersH = data;
	setCoord(markersH,false);
        });

	$.getJSON('https://data.lacity.org/resource/d4vt-q4t5.json?$limit=20&$offset='+num.toString()+'&$order=createddate DESC&$where=requesttype = "Graffiti Removal"', function(data) {
    //data is the JSON string
	markersG = data;
	setCoord(markersG,true);
        });

	function setCoord(json_data,isEnd){
	  var j=0;
	  while(j<json_data.length&&json_data[j].latitude)j++;
	  setNext(j); 
	  function setNext(j){
		if(j<json_data.length){
			var k = j+1;
			while(k<json_data.length&&json_data[k].latitude)k++;

	    		var add = json_data[j].address;
			add = add.replace(/ /g , '+');
	   		add = add.replace(/,/g,'');
			add = add +'+LOS ANGELES';
			
			setTimeout(function(){
			    $.getJSON( 'http://maps.google.com/maps/api/geocode/json?address=' + add,
					function(data){
						setNext(k);
						json_data[j].latitude = data['results'][0]['geometry']['location']['lat'];
						json_data[j].longitude = data['results'][0]['geometry']['location']['lng'];
						console.log(j);
					},j,k);

			}, 100,j,k);
		}

		else {
			setTimeout(function(){
				if(isEnd)initMap();
				}, 200);
		     }
	  }
	}
    function setInputs(){
	document.getElementById('dispH').checked = false;
	document.getElementById('dispG').checked = false;
	document.getElementById('dispD').checked = false;
	document.getElementById('dispI').checked = false;
	document.getElementById('dispE').checked = false;
	document.getElementById('dispB').checked = false;
	document.getElementById('dispM').checked = false;
	document.getElementById('dispW').checked = false;
	document.getElementById('dispSS').checked = false;
	document.getElementById('dispMS').checked = false;
        document.getElementById('showText').selectedIndex = 0;
    }


      function initMap() {
	console.log('initializing map');

	setInputs();

        map = new google.maps.Map(document.getElementById("map"), {
          zoom: 10,
          center: {lat: 34.0522, lng: -118.2437}
        });

        var trafficLayer = new google.maps.TrafficLayer();
            trafficLayer.setMap(map);

	markersB = makeMarkers(pinIconB,markersB);
	markersD = makeMarkers(pinIconD,markersD);
	markersE = makeMarkers(pinIconE,markersE);
	markersG = makeMarkers(pinIconG,markersG);
	markersH = makeMarkers(pinIconH,markersH);
	markersI = makeMarkers(pinIconI,markersI);
	markersM = makeMarkers(pinIconM,markersM);
	markersMS = makeMarkers(pinIconMS,markersMS);
	markersW = makeMarkers(pinIconW,markersW);
	markersSS = makeMarkers(pinIconSS,markersSS);


	
        function makeMarkers(pinIcon,json_data){
	  var markers = [];
	  for (var i=0; i<json_data.length; i++){
            
	     markers.push({
			    data : json_data[i],
			    marker : new google.maps.Marker({
					    position: new google.maps.LatLng(json_data[i].latitude, json_data[i].longitude),
					    visible: false,
					    icon: pinIcon,
					    map: map
					    }),
			   window : new google.maps.InfoWindow(),
			   contentString : '<p><b>request type:  </b>' + json_data[i].requesttype + '<br>' +
	    				   '<b>address:  </b>' + json_data[i].address + '<br>' +
	   				   '<b>police precinct:  </b>' + json_data[i].policeprecinct + '<br>' +
	    				   '<b>created date:  </b>' + json_data[i].createddate + '<br>' +
	    				   '<b>action taken:  </b>' + json_data[i].actiontaken + 
					   '</p>',

			   loaded : true
		});

	      var infowindow = markers[i].window;
	      google.maps.event.addListener(markers[i].marker, 'click', (function (infowindow) {
	             return function () {infowindow.open(map, this);}
	         })(infowindow));

	      markers[i].window.setContent(markers[i].contentString);	
	  }
	  return markers
        }
    }


    function setText(markers){
	var content = "";
	for(var i=0; i<markers.length; i++){
	    if(markers[i].contentString != null){
	        content += markers[i].contentString;
	    }
	}
	document.getElementById('text').innerHTML = content;
    }

    function changeState(id)  {
	var markers = [];

	if(id == "dispH") markers = markersH;
	else if(id == "dispG") markers = markersG;
	else if(id == "dispD") markers = markersD;
	else if(id == "dispI") markers = markersI;
	else if(id == "dispE") markers = markersE;
	else if(id == "dispB") markers = markersB;
	else if(id == "dispM") markers = markersM;
	else if(id == "dispW") markers = markersW;
	else if(id == "dispSS") markers = markersSS;
	else if(id == "dispMS") markers = markersMS;

        for (var i=0; i<markers.length; i++){
	    markers[i].marker.setVisible(document.getElementById(id).checked);
	}
    }

    function getChoice() {
	var i = document.getElementById("showText").selectedIndex;
	switch(i){
	    case 0:
		document.getElementById("text").innerHTML = "";
		break;
	    case 1:
		setText(markersH);
		break;
	    case 2:
		setText(markersG);
		break;
	    case 3:
		setText(markersD);
		break;
	    case 4:
		setText(markersI);
		break;
	    case 5:
		setText(markersE);
		break;
	    case 6:
		setText(markersB);
		break;
	    case 7:
		setText(markersM);
		break;
	    case 8:
		setText(markersW);
		break;
	    case 9:
		setText(markersSS);
		break;
	    case 10:
		setText(markersMS);
		break;
	} 
    }




</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALZgGws3IIr5O3LcWZTCD3W3IKa0l6YrI">
</script>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-9"><img src="cci-logo.png"></div>
        <div class="col-md-3" style="padding-top:17px"><img src="i3_logo.png"></div>
    </div>
    <h2>The Latest Updates from Los Angeles Open Data - 311 Service Requests</h2>
</div>




<div class="container">
<div class="row">
	<div class="col-md-2">
	      <label><input id="dispH" type="checkbox" value="hloc" onChange="changeState('dispH')"/>Homeless Encampment</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispG" type="checkbox" value="gloc" onChange="changeState('dispG')"/>Graffiti Removal</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispD" type="checkbox" value="dloc" onChange="changeState('dispD')"/>Dead Animal Removal</label>
	</div>	
	<div class="col-md-2">
	      <label><input id="dispI" type="checkbox" value="iloc" onChange="changeState('dispI')"/>Illegal Dumping Pickup</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispE" type="checkbox" value="eloc" onChange="changeState('dispE')"/>Electronic Waste</label>
	</div>
	<div class="col-md-2"></div>
</div>

<div class="row">
	<div class="col-md-2">
	      <label><input id="dispB" type="checkbox" value="bloc" onChange="changeState('dispB')"/>Bulky Items</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispM" type="checkbox" value="mloc" onChange="changeState('dispM')"/>Metal/Household Appliances</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispW" type="checkbox" value="wloc" onChange="changeState('dispW')"/>Report Water Waste</label>
	</div>	
	<div class="col-md-2">
	      <label><input id="dispSS" type="checkbox" value="ssloc" onChange="changeState('dispSS')"/>Single Streetlight Issue</label>
	</div>
	<div class="col-md-2">
	      <label><input id="dispMS" type="checkbox" value="msloc" onChange="changeState('dispMS')"/>Multiple Streetlight Issue</label>
	</div>
	<div class="col-md-2"></div>
</div>
</div><!--container-->

<div class="container">
<div class="row">
    <div class="col-md-9">
	<div id="map"></div>
    </div>

    <div class="col-md-3">
	<select id="showText" name="theText" onChange="getChoice()">
	<option id="selectText" disabled="true" >Select Text</option>
	<option id="hloc" value="hloc" >Homeless Encampment</option>
	<option id="gloc" value="gloc" >Graffiti Removal</option>
	<option id="dloc" value="dloc" >Dead Animal Removal</option>
	<option id="iloc" value="iloc" >Illegal Dumping Pickup</option>
	<option id="eloc" value="eloc" >Electronic Waste</option>
	<option id="bloc" value="bloc" >Bulky Items</option>
	<option id="mloc" value="mloc" >Metal/Household Appliances</option>
	<option id="wloc" value="wloc" >Report Water Waste</option>
	<option id="ssloc" value="ssloc" >Single Streetlight Issue</option>
	<option id="msloc" value="msloc" >Multiple Streetlight Issue</option>
	</select> 
	<div id="text" style="overflow-y:scroll; height:450px; padding:10px 10px 10px 10px" ></div> 
    </div>
</div>
</div>

<div style="height:100px"></div>


</body>
</html>
